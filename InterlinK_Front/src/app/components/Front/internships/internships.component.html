<app-navbar></app-navbar>

<div class="internships-container">
  <h1 class="title">Find Your Ideal Internship</h1>
  <div class="internships-layout">
    <!-- Filters on the right -->
    <div class="filters-section">
      <h3>Filters</h3>
      <div class="filter-group">
        <label for="location">📍 Location</label>
        <input
          type="text"
          id="location"
          [(ngModel)]="locationFilter"
          (ngModelChange)="applyFilters()"
          placeholder="Enter a city"
        />
      </div>
      <div class="filter-group">
        <label for="duration">⏳ Duration</label>
        <select
          id="duration"
          [(ngModel)]="durationFilter"
          (ngModelChange)="applyFilters()"
        >
          <option value="">All durations</option>
          <option value="FOUR_WEEKS">4 weeks</option>
          <option value="SIX_WEEKS">6 weeks</option>
          <option value="EIGHT_WEEKS">8 weeks</option>
          <option value="SIX_MONTHS">6 months</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="type">📌 Type</label>
        <select
          id="type"
          [(ngModel)]="typeFilter"
          (ngModelChange)="applyFilters()"
        >
          <option value="">All types</option>
          <option value="FULL_TIME">Full-time</option>
          <option value="PART_TIME">Part-time</option>
          <option value="REMOTE">Remote</option>
          <option value="HYBRID">Hybrid</option>
        </select>
      </div>
    </div>

    <!-- Internship list -->
    <div class="internships-list">
      <div *ngFor="let internship of filteredInternships" class="internship-card">
        <h3 class="internship-title">{{ internship.title }}</h3>
        <p class="company-name">{{ internship.companyName }}</p>
        <p class="location">📍 {{ internship.localisation }}</p>
        <p class="duration">⏳ {{ internship.duration }}</p>
        <p class="type">📌 {{ internship.type }}</p>
        <p class="start-date">📅 Start date: {{ internship.startDate | date:'dd/MM/yyyy' }}</p>
        <p class="available-spots">👥 Available spots: {{ internship.availableSpots }}</p>
        <!-- Rating display -->
        <div class="rating" *ngIf="getRating(internship.internshipId) > 0">
          ★ {{ getRating(internship.internshipId) | number:'1.1-1' }}
          ({{ getRatingCount(internship.internshipId) }} avis)
        </div>

        <!-- Rate button -->
        <button 
          *ngIf="!hasRated(internship.internshipId)"
          (click)="openRatingModal(internship)"
          class="rate-btn"
        >
        Rate this internship
        </button>

        <button (click)="applyForInternship(internship)" class="apply-btn">Apply</button>
      </div>
    </div>
  </div>

  <!-- Application form modal -->
  <div *ngIf="selectedInternship" class="modal-overlay">
    <!-- Your existing application form -->
  </div>

  <!-- Rating modal -->
  <div *ngIf="selectedInternshipForRating" class="modal-overlay">
    <div class="rating-modal">
      <h3>Noter {{ selectedInternshipForRating.title }}</h3>
      <button (click)="selectedInternshipForRating = null" class="close-btn">&times;</button>
      <div class="stars">
        <span 
          *ngFor="let star of [1,2,3,4,5]" 
          (click)="selectedRating = star"
          [class.active]="star <= selectedRating">★</span>
      </div>
      <textarea [(ngModel)]="ratingComment" placeholder="Votre avis..."></textarea>
      <button (click)="submitRating()">Envoyer</button>
    </div>
  </div>
  <!-- Application form overlay (modal) -->
  <div *ngIf="selectedInternship" class="modal-overlay">
    <div class="application-form">
      <h3 class="form-title">Apply for: {{ selectedInternship.title }}</h3>
      <button (click)="cancelApplication()" class="close-btn">&times;</button>
      <form (ngSubmit)="onSubmitAddApplication()">
       
        <div class="mb-3">
          <label for="firstName" class="form-label">First Name</label>
          <input type="text" id="firstName" class="form-control" formControlName="firstName">
        </div>
        <div class="mb-3">
          <label for="lastName" class="form-label">Last Name</label>
          <input type="text" id="lastName" class="form-control" formControlName="lastName">
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" id="email" class="form-control" formControlName="email">
        </div>
        <div class="mb-3">
          <label for="phone" class="form-label">Phone</label>
          <input type="tel" id="phone" class="form-control" formControlName="phone">
        </div>
       
        <div class="form-group">
          <label for="cv">CV</label>
          <input
          type="file"
          id="cv"
          class="form-control"
          (change)="onFileSelected($event)"
          accept=".pdf,.doc,.docx,.txt"
          required
        />        </div>
      
        <div class="mb-3">
          <label for="status" class="form-label">Status</label>
          <select id="status" class="form-control" formControlName="status">
            <option *ngFor="let status of getEnumValues(ApplicationStatus)" [value]="status">
              {{ formatEnumValue(status) }}
            </option>
          </select>
        </div>
  
        <div class="btn-group">
          <button type="submit" class="submit-btn">Submit</button>
          <button type="button" (click)="cancelApplication()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
</div>