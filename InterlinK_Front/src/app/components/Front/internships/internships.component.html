<app-navbar></app-navbar>
<div class="internships-container">
  <h1 class="title">Find Your Ideal Internship</h1>
  <div class="internships-layout">
    <!-- Filters on the right -->
    <div class="filters-section">
      <h3>Filters</h3>
      <div class="filter-group">
        <label for="location">üìç Location</label>
        <input
          type="text"
          id="location"
          [(ngModel)]="locationFilter"
          (ngModelChange)="applyFilters()"
          placeholder="Enter a city"
        />
      </div>
      <div class="filter-group">
        <label for="duration">‚è≥ Duration</label>
        <select
          id="duration"
          [(ngModel)]="durationFilter"
          (ngModelChange)="applyFilters()"
        >
          <option value="">All durations</option>
          <option value="FOUR_WEEKS">4 weeks</option>
          <option value="SIX_WEEKS">6 weeks</option>
          <option value="EIGHT_WEEKS">8 weeks</option>
          <option value="SIX_MONTHS">6 months</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="type">üìå Type</label>
        <select
          id="type"
          [(ngModel)]="typeFilter"
          (ngModelChange)="applyFilters()"
        >
          <option value="">All types</option>
          <option value="FULL_TIME">Full-time</option>
          <option value="PART_TIME">Part-time</option>
          <option value="REMOTE">Remote</option>
          <option value="HYBRID">Hybrid</option>
        </select>
      </div>
      <!-- Bouton pour ouvrir le formulaire de CV -->
    <button class="generate-cv-btn" (click)="showCVForm = true">G√©n√©rer mon CV Automatique</button>
    </div>
 <!-- CV Modal -->
 <div *ngIf="showCVForm" class="modal-overlay">
  <div class="cv-modal">
    <button class="close-btn" (click)="showCVForm = false">&times;</button>
    
    <h2 class="modal-title">Cr√©ation de CV</h2>
    
    <form [formGroup]="cvForm" class="cv-form">
      <!-- Informations Personnelles -->
      <div class="form-section">
        <h3 class="section-title">Informations Personnelles</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Nom Complet</label>
            <input type="text" formControlName="fullName" placeholder="Votre nom complet">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email" placeholder="exemple@email.com">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>T√©l√©phone</label>
            <input type="text" formControlName="phone" placeholder="Num√©ro de t√©l√©phone">
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <input type="text" formControlName="address" placeholder="Votre adresse">
          </div>
        </div>
        <div class="form-group">
          <label>Profil Professionnel</label>
          <textarea formControlName="profile" placeholder="R√©sum√© professionnel (50-100 mots)"></textarea>
        </div>
      </div>

      <!-- Formation -->
      <div formArrayName="education">
        <div class="section-header">
          <h3 class="section-title">Formation</h3>
          <button type="button" class="add-btn" (click)="addEducation()">+ Ajouter</button>
        </div>
        
        <div *ngFor="let edu of getEducationControls(); let i=index" [formGroupName]="i" class="form-section">
          <div class="form-row">
            <div class="form-group">
              <label>Dipl√¥me</label>
              <input formControlName="degree" placeholder="Ex: Licence en Informatique">
            </div>
            <div class="form-group">
              <label>√âtablissement</label>
              <input formControlName="institution" placeholder="Ex: Universit√© ESPRIT">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Ann√©e</label>
              <input formControlName="year" placeholder="Ex: 2020-2023">
            </div>
            <button type="button" class="remove-btn" (click)="removeEducation(i)">Supprimer</button>
          </div>
        </div>
      </div>

      <!-- Exp√©rience Professionnelle -->
      <div formArrayName="experiences">
        <div class="section-header">
          <h3 class="section-title">Exp√©rience Professionnelle</h3>
          <button type="button" class="add-btn" (click)="addExperience()">+ Ajouter</button>
        </div>
        
        <div *ngFor="let exp of getExperienceControls(); let i=index" [formGroupName]="i" class="form-section">
          <div class="form-row">
            <div class="form-group">
              <label>Poste</label>
              <input formControlName="title" placeholder="Ex: D√©veloppeur Full Stack">
            </div>
            <div class="form-group">
              <label>Entreprise</label>
              <input formControlName="company" placeholder="Ex: Soci√©t√© XYZ">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>P√©riode</label>
              <input formControlName="period" placeholder="Ex: Juin 2022 - Ao√ªt 2022">
            </div>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea formControlName="description" placeholder="Vos responsabilit√©s et r√©alisations"></textarea>
          </div>
          <button type="button" class="remove-btn" (click)="removeExperience(i)">Supprimer</button>
        </div>
      </div>

      <!-- Comp√©tences -->
      <div class="form-section">
        <h3 class="section-title">Comp√©tences</h3>
        <div class="skills-container">
          <div class="skill-tags">
            <span *ngFor="let tag of availableSkills" 
                  class="skill-tag"
                  [class.selected]="isSkillSelected(tag)"
                  (click)="toggleSkill(tag)">
              {{tag}}
            </span>
          </div>
          <div class="skill-input-container">
            <input type="text" class="skill-input" placeholder="Ajouter une comp√©tence" 
                   (keyup.enter)="addCustomSkill($event)">
            <button type="button" class="add-skill-btn" (click)="addCustomSkillFromInput()">+</button>
          </div>
        </div>
      </div>

      <!-- Langues -->
      <div formArrayName="languages">
        <div class="section-header">
          <h3 class="section-title">Langues</h3>
          <button type="button" class="add-btn" (click)="addLanguage()">+ Ajouter</button>
        </div>
        
        <div *ngFor="let lang of getLanguageControls(); let i=index" [formGroupName]="i" class="form-section">
          <div class="form-row">
            <div class="form-group">
              <label>Langue</label>
              <input formControlName="name" placeholder="Ex: Fran√ßais">
            </div>
            <div class="form-group">
              <label>Niveau</label>
              <select formControlName="level">
                <option value="D√©butant">D√©butant</option>
                <option value="Interm√©diaire">Interm√©diaire</option>
                <option value="Avanc√©">Avanc√©</option>
                <option value="Bilingue">Bilingue</option>
              </select>
            </div>
          </div>
          <button type="button" class="remove-btn" (click)="removeLanguage(i)">Supprimer</button>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="form-actions">
        <button type="button" class="btn btn-preview" (click)="previewCV()">Aper√ßu</button>
        <button type="button" class="btn btn-download" (click)="generatePDF()">G√©n√©rer PDF</button>
        <button type="button" class="btn btn-save" (click)="saveDraft()">Enregistrer brouillon</button>
        <button type="button" class="btn btn-cancel" (click)="showCVForm = false">Annuler</button>
      </div>
    </form>
  </div>
    <!-- Aper√ßu du CV -->
    <div *ngIf="previewMode" class="cv-preview-container">
      <div id="cv-preview" class="cv-preview">
        <!-- Le contenu du CV sera g√©n√©r√© ici -->
      </div>
      <div class="preview-actions">
        <button (click)="previewMode = false">Retour √† l'√©dition</button>
        <button (click)="generatePDF()">T√©l√©charger PDF</button>
      </div>
    </div>
</div>
    <!-- Internship list -->
    <div class="internships-list">
      <div *ngFor="let internship of filteredInternships" class="internship-card">
        <h3 class="internship-title">{{ internship.title }}</h3>
        <p class="company-name">{{ internship.companyName }}</p>
        <p class="location">üìç {{ internship.localisation }}</p>
        <p class="duration">‚è≥ {{ internship.duration }}</p>
        <p class="type">üìå {{ internship.type }}</p>
        <p class="start-date">üìÖ Start date: {{ internship.startDate | date:'dd/MM/yyyy' }}</p>
        <p class="available-spots">üë• Available spots: {{ internship.availableSpots }}</p>
        <!-- Rating display -->
        <div class="rating" *ngIf="getRating(internship.internshipId) > 0">
          ‚òÖ {{ getRating(internship.internshipId) | number:'1.1-1' }}
          ({{ getRatingCount(internship.internshipId) }} avis)
        </div>

        <!-- Rate button -->
        <button 
          *ngIf="!hasRated(internship.internshipId)"
          (click)="openRatingModal(internship)"
          class="rate-btn"
        >
        Rate this internship
        </button>

        <button (click)="applyForInternship(internship)" class="apply-btn">Apply</button>
      </div>
    </div>
  </div>

  <!-- Application form modal -->
  <div *ngIf="selectedInternship" class="modal-overlay">
    <!-- Your existing application form -->
  </div>

  <!-- Rating modal -->
  <div *ngIf="selectedInternshipForRating" class="modal-overlay">
    <div class="rating-modal">
      <h3>Noter {{ selectedInternshipForRating.title }}</h3>
      <button (click)="selectedInternshipForRating = null" class="close-btn">&times;</button>
      <div class="stars">
        <span 
          *ngFor="let star of [1,2,3,4,5]" 
          (click)="selectedRating = star"
          [class.active]="star <= selectedRating">‚òÖ</span>
      </div>
      <textarea [(ngModel)]="ratingComment" placeholder="Votre avis..."></textarea>
      <button (click)="submitRating()">Envoyer</button>
    </div>
  </div>
  <!-- Application form overlay (modal) -->
  <div *ngIf="selectedInternship" class="modal-overlay">
    <div class="application-form">
      <h3 class="form-title">Apply for: {{ selectedInternship.title }}</h3>
      <button (click)="cancelApplication()" class="close-btn">&times;</button>
      <form (ngSubmit)="onSubmitAddApplication()">
       
        <div class="mb-3">
          <label for="firstName" class="form-label">First Name</label>
          <input type="text" id="firstName" class="form-control" formControlName="firstName">
        </div>
        <div class="mb-3">
          <label for="lastName" class="form-label">Last Name</label>
          <input type="text" id="lastName" class="form-control" formControlName="lastName">
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" id="email" class="form-control" formControlName="email">
        </div>
        <div class="mb-3">
          <label for="phone" class="form-label">Phone</label>
          <input type="tel" id="phone" class="form-control" formControlName="phone">
        </div>
       
        <div class="form-group">
          <label for="cv">CV</label>
          <input
          type="file"
          id="cv"
          class="form-control"
          (change)="onFileSelected($event)"
          accept=".pdf,.doc,.docx,.txt"
          required
        />        </div>
      
        <div class="mb-3">
          <label for="status" class="form-label">Status</label>
          <select id="status" class="form-control" formControlName="status">
            <option *ngFor="let status of getEnumValues(ApplicationStatus)" [value]="status">
              {{ formatEnumValue(status) }}
            </option>
          </select>
        </div>
  
        <div class="btn-group">
          <button type="submit" class="submit-btn">Submit</button>
          <button type="button" (click)="cancelApplication()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
 <!-- Chatbot int√©gr√© -->
 <div class="chatbot-container" [class.open]="chatbot.isOpen">
  <div class="chatbot-header" (click)="toggleChatbot()">
    <h3>Assistant Stages</h3>
    <span>{{ chatbot.isOpen ? '‚àí' : '+' }}</span>
  </div>

  <div class="chatbot-body" *ngIf="chatbot.isOpen">
    <div class="messages">
      <div *ngFor="let msg of chatbot.messages" 
           [class.user-message]="msg.sender === 'user'" 
           [class.bot-message]="msg.sender === 'bot'">
        {{ msg.text }}
      </div>
      
      <div *ngIf="chatbot.isLoading" class="typing-indicator">
        <span>‚óè</span><span>‚óè</span><span>‚óè</span>
      </div>
    </div>

    <div class="suggestions" *ngIf="chatbot.messages.length === 0">
      <p>Essayez de demander :</p>
      <button *ngFor="let suggestion of chatbot.suggestions" 
              (click)="selectSuggestion(suggestion)">
        {{ suggestion }}
      </button>
    </div>

    <div class="input-area">
      <input [(ngModel)]="chatbot.userMessage" 
             placeholder="Posez votre question..." 
             (keyup.enter)="sendChatbotMessage()">
      <button (click)="sendChatbotMessage()">Envoyer</button>
    </div>
  </div>
</div>
</div>