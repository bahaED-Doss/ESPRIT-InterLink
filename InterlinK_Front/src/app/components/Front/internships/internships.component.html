<app-navbar></app-navbar>
<div class="internships-container">
  <h1 class="title">Find Your Ideal Internship</h1>
  <div class="internships-layout">
    <!-- Filters on the right -->
    <div class="filters-section">
      <h3>Filters</h3>
      <div class="filter-group">
        <label for="location">üìç Location</label>
        <input
          type="text"
          id="location"
          [(ngModel)]="locationFilter"
          (ngModelChange)="applyFilters()"
          placeholder="Enter a city"
        />
      </div>
      <div class="filter-group">
        <label for="duration">‚è≥ Duration</label>
        <select
          id="duration"
          [(ngModel)]="durationFilter"
          (ngModelChange)="applyFilters()"
        >
          <option value="">All durations</option>
          <option value="FOUR_WEEKS">4 weeks</option>
          <option value="SIX_WEEKS">6 weeks</option>
          <option value="EIGHT_WEEKS">8 weeks</option>
          <option value="SIX_MONTHS">6 months</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="type">üìå Type</label>
        <select
          id="type"
          [(ngModel)]="typeFilter"
          (ngModelChange)="applyFilters()"
        >
          <option value="">All types</option>
          <option value="FULL_TIME">Full-time</option>
          <option value="PART_TIME">Part-time</option>
          <option value="REMOTE">Remote</option>
          <option value="HYBRID">Hybrid</option>
        </select>
      </div>
    </div>

    <!-- Internship list -->
    <div class="internships-list">
      <div *ngFor="let internship of filteredInternships" class="internship-card">
        <h3 class="internship-title">{{ internship.title }}</h3>
        <p class="company-name">{{ internship.companyName }}</p>
        <p class="location">üìç {{ internship.localisation }}</p>
        <p class="duration">‚è≥ {{ internship.duration }}</p>
        <p class="type">üìå {{ internship.type }}</p>
        <p class="start-date">üìÖ Start date: {{ internship.startDate | date:'dd/MM/yyyy' }}</p>
        <p class="available-spots">üë• Available spots: {{ internship.availableSpots }}</p>
        <!-- Rating display -->
        <div class="rating" *ngIf="getRating(internship.internshipId) > 0">
          ‚òÖ {{ getRating(internship.internshipId) | number:'1.1-1' }}
          ({{ getRatingCount(internship.internshipId) }} avis)
        </div>

        <!-- Rate button -->
        <button 
          *ngIf="!hasRated(internship.internshipId)"
          (click)="openRatingModal(internship)"
          class="rate-btn"
        >
        Rate this internship
        </button>

        <button (click)="applyForInternship(internship)" class="apply-btn">Apply</button>
      </div>
    </div>
  </div>

  <!-- Application form modal -->
  <div *ngIf="selectedInternship" class="modal-overlay">
    <!-- Your existing application form -->
  </div>

  <!-- Rating modal -->
  <div *ngIf="selectedInternshipForRating" class="modal-overlay">
    <div class="rating-modal">
      <h3>Noter {{ selectedInternshipForRating.title }}</h3>
      <button (click)="selectedInternshipForRating = null" class="close-btn">&times;</button>
      <div class="stars">
        <span 
          *ngFor="let star of [1,2,3,4,5]" 
          (click)="selectedRating = star"
          [class.active]="star <= selectedRating">‚òÖ</span>
      </div>
      <textarea [(ngModel)]="ratingComment" placeholder="Votre avis..."></textarea>
      <button (click)="submitRating()">Envoyer</button>
    </div>
  </div>
  <!-- Application form overlay (modal) -->
  <div *ngIf="selectedInternship" class="modal-overlay">
    <div class="application-form">
      <h3 class="form-title">Apply for: {{ selectedInternship.title }}</h3>
      <button (click)="cancelApplication()" class="close-btn">&times;</button>
      <form (ngSubmit)="onSubmitAddApplication()">
       
        <div class="mb-3">
          <label for="firstName" class="form-label">First Name</label>
          <input type="text" id="firstName" class="form-control" formControlName="firstName">
        </div>
        <div class="mb-3">
          <label for="lastName" class="form-label">Last Name</label>
          <input type="text" id="lastName" class="form-control" formControlName="lastName">
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" id="email" class="form-control" formControlName="email">
        </div>
        <div class="mb-3">
          <label for="phone" class="form-label">Phone</label>
          <input type="tel" id="phone" class="form-control" formControlName="phone">
        </div>
       
        <div class="form-group">
          <label for="cv">CV</label>
          <input
          type="file"
          id="cv"
          class="form-control"
          (change)="onFileSelected($event)"
          accept=".pdf,.doc,.docx,.txt"
          required
        />        </div>
      
        <div class="mb-3">
          <label for="status" class="form-label">Status</label>
          <select id="status" class="form-control" formControlName="status">
            <option *ngFor="let status of getEnumValues(ApplicationStatus)" [value]="status">
              {{ formatEnumValue(status) }}
            </option>
          </select>
        </div>
  
        <div class="btn-group">
          <button type="submit" class="submit-btn">Submit</button>
          <button type="button" (click)="cancelApplication()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <div class="cv-container">
    <!-- Bouton pour ouvrir le formulaire de CV -->
    <button class="generate-cv-btn" (click)="showCVForm = true">G√©n√©rer mon CV Automatique</button>
  
    <!-- Formulaire de CV -->
    <div *ngIf="showCVForm" class="cv-form-container">
      <form [formGroup]="cvForm" class="cv-form">
        <h2>Cr√©ation de CV</h2>
        
        <!-- Informations Personnelles -->
        <fieldset formGroupName="personalInfo">
          <legend>Informations Personnelles</legend>
          <div class="form-group">
            <input formControlName="fullName" placeholder="Nom complet" required>
          </div>
          <div class="form-group">
            <input formControlName="email" type="email" placeholder="Email" required>
          </div>
          <div class="form-group">
            <input formControlName="phone" placeholder="T√©l√©phone">
          </div>
          <div class="form-group">
            <textarea formControlName="profile" placeholder="Profil professionnel (50-100 mots)"></textarea>
          </div>
        </fieldset>
  
        <!-- Formation -->
        <div formArrayName="education">
          <h3>Formation <button type="button" (click)="addEducation()">+ Ajouter</button></h3>
          
          <div *ngFor="let edu of getEducationControls(); let i=index">
                        <div class="form-group">
              <input formControlName="degree" placeholder="Dipl√¥me">
            </div>
            <div class="form-group">
              <input formControlName="institution" placeholder="√âtablissement">
            </div>
            <div class="form-group">
              <input formControlName="year" placeholder="Ann√©e">
            </div>
            <button type="button" (click)="removeEducation(i)">Supprimer</button>
          </div>
        </div>
  
        <!-- Exp√©rience Professionnelle -->
        <div formArrayName="experiences">
          <h3>Exp√©rience Professionnelle <button type="button" (click)="addExperience()">+ Ajouter</button></h3>
          
          <div *ngFor="let exp of getExperienceControls(); let i=index" [formGroupName]="i">
            <div class="form-group">
              <input formControlName="title" placeholder="Poste">
            </div>
            <div class="form-group">
              <input formControlName="company" placeholder="Entreprise">
            </div>
            <div class="form-group">
              <input formControlName="period" placeholder="P√©riode (ex: 2020-2022)">
            </div>
            <div class="form-group">
              <textarea formControlName="description" placeholder="Description"></textarea>
            </div>
            <button type="button" (click)="removeExperience(i)">Supprimer</button>
          </div>
        </div>
  
        <!-- Comp√©tences -->
        <div formArrayName="skills">
          <h3>Comp√©tences <button type="button" (click)="addSkill()">+ Ajouter</button></h3>
          
          <div *ngFor="let skill of getSkillControls(); let i=index">
            <input [formControlName]="i" placeholder="Comp√©tence">
            <button type="button" (click)="removeSkill(i)">Supprimer</button>
          </div>
        </div>
  
        <!-- Langues -->
        <div formArrayName="languages">
          <h3>Langues <button type="button" (click)="addLanguage()">+ Ajouter</button></h3>
          
          <div *ngFor="let lang of getLanguageControls(); let i=index" [formGroupName]="i">
            <div class="form-group">
              <input formControlName="name" placeholder="Langue">
            </div>
            <div class="form-group">
              <select formControlName="level">
                <option value="D√©butant">D√©butant</option>
                <option value="Interm√©diaire">Interm√©diaire</option>
                <option value="Avanc√©">Avanc√©</option>
                <option value="Bilingue">Bilingue</option>
              </select>
            </div>
            <button type="button" (click)="removeLanguage(i)">Supprimer</button>
          </div>
        </div>
  
        <div class="form-actions">
          <button type="button" (click)="previewCV()">Aper√ßu</button>
          <button type="button" (click)="generatePDF()">G√©n√©rer PDF</button>
          <button type="button" (click)="saveDraft()">Enregistrer brouillon</button>
          <button type="button" (click)="showCVForm = false">Annuler</button>
        </div>
      </form>
    </div>
  
    <!-- Aper√ßu du CV -->
    <div *ngIf="previewMode" class="cv-preview-container">
      <div id="cv-preview" class="cv-preview">
        <!-- Le contenu du CV sera g√©n√©r√© ici -->
      </div>
      <div class="preview-actions">
        <button (click)="previewMode = false">Retour √† l'√©dition</button>
        <button (click)="generatePDF()">T√©l√©charger PDF</button>
      </div>
    </div>
  </div>
  <!-- Ajoutez ceci o√π vous voulez le chatbot --><!-- Remplacez la section chatbot existante par : 
<div class="chatgpt-container">
  <div class="chat-header">
    <h3>Assistant Stages</h3>
  </div>
  
  <div class="chat-messages">
    <div *ngFor="let msg of ChatMessage" [class]="msg.role + '-message'">
      <div class="message-content">
        {{ msg.content }}
      </div>
    </div>
    
    <div *ngIf="isWaitingForAI" class="typing-indicator">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>
  
  <div class="chat-input">
    <textarea [(ngModel)]="userMessage" 
              (keydown.enter)="$event.preventDefault(); sendMessage()"
              placeholder="Posez votre question..."></textarea>
    <button (click)="sendMessage()" [disabled]="isWaitingForAI">
      <span *ngIf="!isWaitingForAI">Envoyer</span>
      <span *ngIf="isWaitingForAI">...</span>
    </button>
  </div>
</div>-->
</div>
